<!DOCTYPE html>
<html>
	<% include partials/head.ejs %>
	<body>
		<main class="center">	
			<form id="sign-up" class="form text-center">
				<i class="material-icons md-64">school</i>
				<h2>Enter your details</h2>
				<fieldset>
					<input type="text" id="name" class="input input-line" placeholder="Name" required autofocus>
					<div id="name-error" class="form-error"></div>
					<input type="text" id="username" class="input input-line" placeholder="Username" required>
					<div id="username-error" class="form-error"></div>
					<input type="password" id="password" class="input input-line" placeholder="Password" required>
					<div id="password-error" class="form-error"></div>
				</fieldset>
				<button type="submit" class="btn btn-lg btn-submit">Sign Up</button>
			</form>
		</main>
		<script>
			document.getElementById('sign-up').addEventListener('submit', function(event) {
				event.preventDefault();

				let name = document.getElementById('name');
				let username = document.getElementById('username');
				let password = document.getElementById('password');
				let nameError = document.getElementById('name-error');
				let usernameError = document.getElementById('username-error');
				let passwordError = document.getElementById('password-error');

				let params = 'name='+name.value+'&username='+username.value+'&password='+password.value;

				let xhr = new XMLHttpRequest();
				xhr.open('POST', '/signup');
				xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
				xhr.send(params);
				xhr.onload = function() {
					if (this.status === 200) {
						let data = JSON.parse(this.responseText);
						if (data.success === true) {
							window.location.href = '<%= url %>' + 'profile';
						} else {
							if (data.errors.username) usernameError.innerHTML = data.errors.username;
						}
					}
				}
			});

			document.getElementById('username').addEventListener('focus', function() {
				document.getElementById('username-error').innerHTML = '';
			});
		</script>
	</body>
</html>